<p align="center">
    <img src="https://raw.githubusercontent.com/martomi/chiadog/main/logo.jpg" />
</p>
<p align="center">
    Photo by <a href="https://unsplash.com/@tukacszoltan1984?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Zoltan Tukacs</a> on <a href="https://unsplash.com/s/photos/dog-grass?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>
</p>

--------------------------------------------------------------------

# Watchdog for your Chia farm

So you've become a [Chia](https://www.chia.net) farmer and are now looking to improve the uptime of your farm? How about
some automated monitoring that sends notifications directly to your phone?

This tool parses the `debug.log` generated by the chia process and runs various checks to determine the health of your
farming operations. It can detect if your node has lost sync and the farmer is no longer participating in challenges, or
if one of your external HDDs disconnected and your harvester doesn't have access to the full amount of plots you have.

## List of checked conditions:

- Time since last eligible farming event
- Non-decreasing number of total plots farmed
- Quick plot seeking time when responding to a challenge
- Whether a challenge proof was found

## Smartphone Notifications

In case of deviations from the expected values, notifications with low, normal, or high priority can be triggered.
Currently the tool supports integration with [Pushover](https://pushover.net/)
which is available for both Android and iOS. High priority notifications can be configured from the Pushover app to
overwrite any Silence or Do-Not-Disturb modes on your phone and sound a loud alarm at any time of the day to make you
aware of any issues in a timely manner.

# Getting started

**So far only tested on Ubuntu 20.04. Requires Python 3.7+.**

1. Clone the repository

```
git clone https://github.com/martomi/chiadog.git
cd chiadog
```

2. Create virtual env (Recommended)

```
python3 -m venv venv
. ./venv/bin/activate
```

3. Install the dependencies:

```
pip3 install -r requirements.txt
```

4. Copy the example config file

```
cp config-example.yaml config.yaml
```

5. Edit the configuration file
    - Enable Pushover Notifier
    - Set your Pushover API token
    - Set your Pushover user key
    - Double-check the path to your chia logs

6. Start the watchdog

```
python3 main.py --config config.yaml
```

7. Verify that your plots are detected. Within a few seconds you should see INFO log:

```
Detected new plots. Farming with 42 plots.
```

## Troubleshooting

The best way to check that everything works on your system is to run the unit tests:

```
PUSHOVER_API_TOKEN=<your_token> PUSHOVER_USER_KEY=<your_key> python3 -m unittest
```

If your Pushover API token and user key are correctly set in the snippet above, you should receive notifications on your
phone and the tests should complete with an `OK` status:

You can also enable more verbose logging from `config.yaml` by changing `INFO` to `DEBUG`. Then you'll be able to see
logs for every keep-alive event from the harvester.

# Extending & Contributing

Contributions are welcome, I've added a good amount of doxygen style comments and structured the code in a way that
should make this easier. Happy to provide feedback on PRs.

## Modular and extendable design

Here are some jump-off points where you can start adding extensions:

- additional [condition checks](src/chia_log/handlers/harvester_activity_handler.py) e.g. time since last eligible plot
- additional [parsers](src/chia_log/parsers) to monitor other parts of the log output (e.g. timelord)
- additional [log consumers](src/chia_log/log_consumer.py) to support watchdog over the network (NetworkLogConsumer)
- additional [notifiers](src/notifier) to support notifications over Slack, WhatsApp, E-mail, etc.

## Further feature wishes

- Handlers for automated recovery
    - auto-restart chia processes if node cannot re-sync
    - auto-restart xHCI devices to recover external HDDs