<p align="center">
    <img src="https://raw.githubusercontent.com/martomi/chiadog/main/logo.jpg" />
</p>
<p align="center">
    Photo by <a href="https://unsplash.com/@tukacszoltan1984?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Zoltan Tukacs</a> on <a href="https://unsplash.com/s/photos/dog-grass?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>
</p>

--------------------------------------------------------------------

# Watchdog for your Chia farm

So you've become a [Chia](https://www.chia.net) farmer and want to maximize the probability of getting a reward?
Chiadog helps with automated monitoring and sends you a mobile notification in case something appears to malfunction.

## Supported Notifications

| Subsystem | Notification (example values) | Priority |
| ------------- | ------------- | ------|
| Harvester | No keep-alive events from harvester for the past 400 seconds. Your harvester appears to be offline! | HIGH |
| Harvester | The total plot count decreased from 100 to 40.  | HIGH |
| Harvester | Harvester did not participate in any challenge for 120 seconds. This might indicate networking issues. | NORMAL |
| Harvester | Seeking plots took too long: 40 seconds! | NORMAL |
| Harvester | Found 1 proof(s)! | LOW |
| Full Node | Skipped some signage points! Last processed 12/64, current 43/64. This indicates networking issues. | NORMAL |

## How it works?

It parses the `debug.log` generated by the chia process and runs various checks to determine the health of your
farmer. Among others, it can detect if your node has lost sync and the farmer is no longer participating in challenges, or
if one of your external HDDs disconnected and your harvester doesn't have access to the full amount of plots you have.

## Supported Integrations for Notifications

### Pushover

[Pushover](https://pushover.net/) is available for both Android and iOS. High priority notifications can be configured from the Pushover app to
overwrite any Silence or Do-Not-Disturb modes on your phone and sound a loud alarm at any time of the day to make you
aware of any issues in a timely manner.

### Slack, WhatsApp, E-Mail, ...?

These integrations can be easily added. Contributions are welcome!

# Getting started

## Pre-requisites
- UNIX-based OS (Linux/Mac) - contributions to support Windows are welcome!
- Python 3.7+
- Enabled `INFO` logs on your chia farmer

### How to enable INFO logs on chia farmer?

First configure the log level to `INFO`. This ensures that all logs necessary for chiadog
to operate are available under `~/.chia/mainnet/log/debug.log`.
```
chia configure -log-level=INFO
```
Then restart your farmer to apply the changes:
```
chia start --restart farmer
```
Check that logs are coming in:
```
cat ~/.chia/mainnet/log/debug.log
```

## Running Chiadog

1. Clone the repository

```
git clone https://github.com/martomi/chiadog.git
cd chiadog
```

2. Create virtual env (Recommended)

```
python3 -m venv venv
. ./venv/bin/activate
```

3. Install the dependencies:

```
pip3 install -r requirements.txt
```

4. Copy the example config file

```
cp config-example.yaml config.yaml
```

5. Edit the configuration file
    - Enable Pushover Notifier
    - Set your Pushover API token
    - Set your Pushover user key
    - Double-check the path to your chia logs

6. Start the watchdog

```
python3 main.py --config config.yaml
```

7. Verify that your plots are detected. Within a few seconds you should see INFO log:

```
Detected new plots. Farming with 42 plots.
```

## Troubleshooting

The best way to check that everything works on your system is to run the unit tests:

```
PUSHOVER_API_TOKEN=<your_token> PUSHOVER_USER_KEY=<your_key> python3 -m unittest
```

If your Pushover API token and user key are correctly set in the snippet above, you should receive notifications on your
phone and the tests should complete with an `OK` status:

You can also enable more verbose logging from `config.yaml` by changing `INFO` to `DEBUG`. Then you'll be able to see
logs for every keep-alive event from the harvester.

# Contributing

Contributions are always welcome! Please refer to [CONTRIBUTING](CONTRIBUTING.md) documentation.